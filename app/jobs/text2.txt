class SpreadsheetsImportJob < ApplicationJob
  queue_as :default

  # performメソッドを定義
  def perform(spreadsheet_id, range, quiz_id)
    # APIで取得したデータをresローカル変数に代入
    res = google_spreadsheet_service.get_values(spreadsheet_id, range)
    # 値が空だった場合はここで終了
    return if res.values.empty?

    res.values.drop(1).each do |r|
      question = Question.create(
        quiz_id: quiz_id,
        question: r[0]
      )
    end

    res.values.drop(1).each do |r|
      answer = Answer.create(
        question_id: quiz_id,
        correct: r[1],
        incorrect_1: r[2],
        incorrect_2: r[3],
        comment: r[4]
      )
    end

    # デバック用
    # コンソールにて SpreadsheetsImportJob.perform_now("19pNJTNF2lRx45zKisC7H3HtqVOrhbojwZToz0rRs_30", ["シート1!A:E"], 1) を実行する
  end

  private

    def google_spreadsheet_service
      @google_spreadsheet_service ||= Google::Spreadsheets.new
    end

end

# resからquestionsとanswersを作る方法
# https://paiza.io/projects/Ph6d5ad8x_JUrfU5URm0fQ?locale=en-us